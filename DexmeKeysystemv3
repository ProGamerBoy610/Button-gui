local GET_KEY_URL = "https://direct-link.net/1288863/lhjzCfsIf9Ql"
local GITHUB_KEYS_URL = "https://pastefy.app/XqHMKKKh/raw"

local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")

local fSetClipboard = setclipboard or toclipboard

local function getHWID()
    local success, hwid = pcall(function()
        return game:GetService("RbxAnalyticsService"):GetClientId()
    end)
    return success and hwid or HttpService:GenerateGUID(false)
end

local function validateKey(key)
    local hwid = getHWID()

    local success, response = pcall(function()
        return game:HttpGet(GITHUB_KEYS_URL)
    end)
    
    if not success then
        return false, "Network error: Unable to connect to the server. Please check your internet connection."
    end
    
    local validKeys = {}
    
    if string.find(response, ",") then
        for validKey in string.gmatch(response, "([^,]+)") do
            validKey = validKey:match("^%s*(.-)%s*$") -- trim whitespace
            if validKey ~= "" then
                table.insert(validKeys, validKey)
            end
        end
    else
        for validKey in string.gmatch(response, "([^\n]+)") do
            validKey = validKey:match("^%s*(.-)%s*$") -- trim whitespace
            if validKey ~= "" then
                table.insert(validKeys, validKey)
            end
        end
    end
    
    local trimmedKey = key:match("^%s*(.-)%s*$")
    
    for _, validKey in ipairs(validKeys) do
        if trimmedKey == validKey then
            return true, "Key validated successfully! Loading script..."
        end
    end
    
    return false, "Invalid key. Please get a valid key and try again."
end

local function createKeySystemGUI(scriptURL)
    repeat task.wait(1) until game:IsLoaded()
    
    local ScreenGui = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    local UICorner = Instance.new("UICorner")
    local GlowFrame = Instance.new("Frame")
    local GlowCorner = Instance.new("UICorner")
    local HeaderFrame = Instance.new("Frame")
    local HeaderCorner = Instance.new("UICorner")
    local IconLabel = Instance.new("TextLabel")
    local Title = Instance.new("TextLabel")
    local Subtitle = Instance.new("TextLabel")
    local ContentFrame = Instance.new("Frame")
    local TextBoxFrame = Instance.new("Frame")
    local TextBoxCorner = Instance.new("UICorner")
    local TextBox = Instance.new("TextBox")
    local ButtonsFrame = Instance.new("Frame")
    local GetKeyButton = Instance.new("TextButton")
    local GetKeyCorner = Instance.new("UICorner")
    local CheckKeyButton = Instance.new("TextButton")
    local CheckKeyCorner = Instance.new("UICorner")
    local StatusFrame = Instance.new("Frame")
    local StatusCorner = Instance.new("UICorner")
    local StatusLabel = Instance.new("TextLabel")
    local FooterLabel = Instance.new("TextLabel")
    
    -- ScreenGui Setup
    ScreenGui.Name = "KeySystemGUI"
    ScreenGui.Parent = game.CoreGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.ResetOnSpawn = false
    
    -- Glow Frame (Outer glow effect)
    GlowFrame.Name = "GlowFrame"
    GlowFrame.Parent = ScreenGui
    GlowFrame.BackgroundColor3 = Color3.fromRGB(100, 50, 200)
    GlowFrame.BackgroundTransparency = 0.7
    GlowFrame.BorderSizePixel = 0
    GlowFrame.Position = UDim2.new(0.5, -215, 0.5, -185)
    GlowFrame.Size = UDim2.new(0, 430, 0, 370)
    GlowCorner.CornerRadius = UDim.new(0, 25)
    GlowCorner.Parent = GlowFrame
    
    -- Main Frame
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = ScreenGui
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    MainFrame.BorderSizePixel = 0
    MainFrame.Position = UDim2.new(0.5, -200, 0.5, -170)
    MainFrame.Size = UDim2.new(0, 400, 0, 340)
    MainFrame.Active = true
    UICorner.CornerRadius = UDim.new(0, 20)
    UICorner.Parent = MainFrame
    
    -- Header Frame
    HeaderFrame.Name = "HeaderFrame"
    HeaderFrame.Parent = MainFrame
    HeaderFrame.BackgroundColor3 = Color3.fromRGB(80, 40, 160)
    HeaderFrame.BorderSizePixel = 0
    HeaderFrame.Size = UDim2.new(1, 0, 0, 90)
    HeaderCorner.CornerRadius = UDim.new(0, 20)
    HeaderCorner.Parent = HeaderFrame
    
    -- Icon Label
    IconLabel.Name = "IconLabel"
    IconLabel.Parent = HeaderFrame
    IconLabel.BackgroundTransparency = 1
    IconLabel.Position = UDim2.new(0, 0, 0, 10)
    IconLabel.Size = UDim2.new(1, 0, 0, 35)
    IconLabel.Font = Enum.Font.GothamBold
    IconLabel.Text = "üîê"
    IconLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    IconLabel.TextSize = 32
    
    -- Title Label
    Title.Name = "Title"
    Title.Parent = HeaderFrame
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0, 0, 0, 45)
    Title.Size = UDim2.new(1, 0, 0, 25)
    Title.Font = Enum.Font.GothamBold
    Title.Text = "SECURITY ACCESS"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 20
    
    -- Subtitle Label
    Subtitle.Name = "Subtitle"
    Subtitle.Parent = HeaderFrame
    Subtitle.BackgroundTransparency = 1
    Subtitle.Position = UDim2.new(0, 0, 0, 68)
    Subtitle.Size = UDim2.new(1, 0, 0, 18)
    Subtitle.Font = Enum.Font.Gotham
    Subtitle.Text = "Enter your authentication key"
    Subtitle.TextColor3 = Color3.fromRGB(220, 220, 255)
    Subtitle.TextSize = 12
    
    -- Content Frame
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Parent = MainFrame
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.Position = UDim2.new(0, 20, 0, 105)
    ContentFrame.Size = UDim2.new(1, -40, 1, -125)
    
    -- TextBox Frame
    TextBoxFrame.Name = "TextBoxFrame"
    TextBoxFrame.Parent = ContentFrame
    TextBoxFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    TextBoxFrame.BorderSizePixel = 0
    TextBoxFrame.Position = UDim2.new(0, 0, 0, 0)
    TextBoxFrame.Size = UDim2.new(1, 0, 0, 45)
    TextBoxCorner.CornerRadius = UDim.new(0, 12)
    TextBoxCorner.Parent = TextBoxFrame
    
    -- TextBox
    TextBox.Name = "TextBox"
    TextBox.Parent = TextBoxFrame
    TextBox.BackgroundTransparency = 1
    TextBox.Position = UDim2.new(0, 15, 0, 0)
    TextBox.Size = UDim2.new(1, -30, 1, 0)
    TextBox.Font = Enum.Font.GothamMedium
    TextBox.PlaceholderText = "Paste your key here..."
    TextBox.Text = ""
    TextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    TextBox.TextSize = 14
    TextBox.ClearTextOnFocus = false
    TextBox.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Buttons Frame
    ButtonsFrame.Name = "ButtonsFrame"
    ButtonsFrame.Parent = ContentFrame
    ButtonsFrame.BackgroundTransparency = 1
    ButtonsFrame.Position = UDim2.new(0, 0, 0, 60)
    ButtonsFrame.Size = UDim2.new(1, 0, 0, 45)
    
    -- Get Key Button
    GetKeyButton.Name = "GetKeyButton"
    GetKeyButton.Parent = ButtonsFrame
    GetKeyButton.BackgroundColor3 = Color3.fromRGB(70, 35, 140)
    GetKeyButton.BorderSizePixel = 0
    GetKeyButton.Position = UDim2.new(0, 0, 0, 0)
    GetKeyButton.Size = UDim2.new(0.48, 0, 1, 0)
    GetKeyButton.Font = Enum.Font.GothamBold
    GetKeyButton.Text = "üîë GET KEY"
    GetKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    GetKeyButton.TextSize = 14
    GetKeyCorner.CornerRadius = UDim.new(0, 12)
    GetKeyCorner.Parent = GetKeyButton
    
    -- Check Key Button
    CheckKeyButton.Name = "CheckKeyButton"
    CheckKeyButton.Parent = ButtonsFrame
    CheckKeyButton.BackgroundColor3 = Color3.fromRGB(40, 180, 100)
    CheckKeyButton.BorderSizePixel = 0
    CheckKeyButton.Position = UDim2.new(0.52, 0, 0, 0)
    CheckKeyButton.Size = UDim2.new(0.48, 0, 1, 0)
    CheckKeyButton.Font = Enum.Font.GothamBold
    CheckKeyButton.Text = "‚úì VERIFY"
    CheckKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CheckKeyButton.TextSize = 14
    CheckKeyCorner.CornerRadius = UDim.new(0, 12)
    CheckKeyCorner.Parent = CheckKeyButton
    
    -- Status Frame
    StatusFrame.Name = "StatusFrame"
    StatusFrame.Parent = ContentFrame
    StatusFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    StatusFrame.BorderSizePixel = 0
    StatusFrame.Position = UDim2.new(0, 0, 0, 120)
    StatusFrame.Size = UDim2.new(1, 0, 0, 70)
    StatusCorner.CornerRadius = UDim.new(0, 12)
    StatusCorner.Parent = StatusFrame
    
    -- Status Label
    StatusLabel.Name = "StatusLabel"
    StatusLabel.Parent = StatusFrame
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Position = UDim2.new(0, 15, 0, 10)
    StatusLabel.Size = UDim2.new(1, -30, 1, -20)
    StatusLabel.Font = Enum.Font.Gotham
    StatusLabel.Text = "üëã Welcome! Click 'GET KEY' to obtain your access key."
    StatusLabel.TextColor3 = Color3.fromRGB(180, 180, 220)
    StatusLabel.TextSize = 12
    StatusLabel.TextWrapped = true
    StatusLabel.TextYAlignment = Enum.TextYAlignment.Top
    
    -- Footer Label
    FooterLabel.Name = "FooterLabel"
    FooterLabel.Parent = ContentFrame
    FooterLabel.BackgroundTransparency = 1
    FooterLabel.Position = UDim2.new(0, 0, 1, -15)
    FooterLabel.Size = UDim2.new(1, 0, 0, 15)
    FooterLabel.Font = Enum.Font.GothamBold
    FooterLabel.Text = "SECURE KEY SYSTEM"
    FooterLabel.TextColor3 = Color3.fromRGB(100, 100, 120)
    FooterLabel.TextSize = 10
    
    -- Button Hover Effects
    GetKeyButton.MouseEnter:Connect(function()
        TweenService:Create(GetKeyButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(90, 45, 180)}):Play()
    end)
    
    GetKeyButton.MouseLeave:Connect(function()
        TweenService:Create(GetKeyButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 35, 140)}):Play()
    end)
    
    CheckKeyButton.MouseEnter:Connect(function()
        TweenService:Create(CheckKeyButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 200, 120)}):Play()
    end)
    
    CheckKeyButton.MouseLeave:Connect(function()
        TweenService:Create(CheckKeyButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 180, 100)}):Play()
    end)

    -- Get Key Button Click
    GetKeyButton.MouseButton1Click:Connect(function()
        pcall(function()
            fSetClipboard(GET_KEY_URL)
        end)
        StatusLabel.Text = "üìã Key link copied to clipboard! Paste it in your browser to get your key."
        StatusLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
    end)

    -- Check Key Button Click
    CheckKeyButton.MouseButton1Click:Connect(function()
        local enteredKey = TextBox.Text
        
        if enteredKey == "" or #enteredKey < 1 then
            StatusLabel.Text = "‚ùå Error: Please enter a valid key (minimum 10 characters)."
            StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            return
        end
        
        StatusLabel.Text = "‚è≥ Validating key, please wait..."
        StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 100)

        task.spawn(function()
            local success, message = validateKey(enteredKey)
            
            if success then
                StatusLabel.Text = "‚úì Key validated! Loading script..."
                StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                
                task.wait(1)
                
                ScreenGui:Destroy()
                
                if scriptURL then
                    local scriptSuccess, scriptErr = pcall(function()
                        loadstring(game:HttpGet(scriptURL))()
                    end)
                    if not scriptSuccess then
                        warn("Failed to load script: " .. tostring(scriptErr))
                    end
                end
            else
                StatusLabel.Text = "‚úó Validation failed: " .. (message or "")
                StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            end
        end)
    end)
    
    print("Key System Loaded! Please enter your key to continue.")
end

local KeySystem = {}

function KeySystem:Load(scriptURL)
    createKeySystemGUI(scriptURL)
end

return KeySystem
